<?php
require_once '../includes/config.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏—Å—Ç–µ–º–∏
require_once '../includes/db.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
require_once '../includes/auth.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

// –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—é —Å—Ç–æ—Ä—ñ–Ω–∫–∏
header("Cache-Control: no-store, no-cache, must-revalidate, max-age=0"); // –í–∏–º–∫–Ω–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è
header("Cache-Control: post-check=0, pre-check=0", false); // –î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è
header("Pragma: no-cache"); // –í–∏–º–∫–Ω–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤
header("Expires: 0"); // –ù–µ–≥–∞–π–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó —Å—Ç–æ—Ä—ñ–Ω–∫–∏

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
if (!isLoggedIn()) {
    header("Location: login.php"); // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É, —è–∫—â–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π
    exit;
}

$conn = getDbConnection(); // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
$response = ['success' => false, 'message' => '']; // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ –¥–ª—è AJAX

// –°–ø–∏—Å–æ–∫ –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö –æ–±–ª–∞—Å—Ç–µ–π
$allowed_regions = [
    '–í—ñ–Ω–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–í–æ–ª–∏–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–î–Ω—ñ–ø—Ä–æ–ø–µ—Ç—Ä–æ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–î–æ–Ω–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ñ–∏—Ç–æ–º–∏—Ä—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ó–∞–∫–∞—Ä–ø–∞—Ç—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ó–∞–ø–æ—Ä—ñ–∑—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–Ü–≤–∞–Ω–æ-–§—Ä–∞–Ω–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ö–∏—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ö—ñ—Ä–æ–≤–æ–≥—Ä–∞–¥—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–õ—É–≥–∞–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–õ—å–≤—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ú–∏–∫–æ–ª–∞—ó–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–û–¥–µ—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ü–æ–ª—Ç–∞–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–†—ñ–≤–Ω–µ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–°—É–º—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–¢–µ—Ä–Ω–æ–ø—ñ–ª—å—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–•–∞—Ä–∫—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–•–µ—Ä—Å–æ–Ω—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–•–º–µ–ª—å–Ω–∏—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ß–µ—Ä–∫–∞—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ß–µ—Ä–Ω—ñ–≤–µ—Ü—å–∫–∞ –æ–±–ª–∞—Å—Ç—å',
    '–ß–µ—Ä–Ω—ñ–≥—ñ–≤—Å—å–∫–∞ –æ–±–ª–∞—Å—Ç—å'
];

if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    header('Content-Type: application/json'); // –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–∏–ø—É –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ JSON

    $type = isset($_POST['type']) ? $conn->real_escape_string(trim($_POST['type'])) : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Ç–∏–ø—É –ø—Ä–æ–±–ª–µ–º–∏
    $description = isset($_POST['description']) ? $conn->real_escape_string(trim($_POST['description'])) : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–ø–∏—Å—É
    $region = isset($_POST['region']) ? $conn->real_escape_string(trim($_POST['region'])) : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –æ–±–ª–∞—Å—Ç—ñ
    $city = isset($_POST['city']) ? $conn->real_escape_string(trim($_POST['city'])) : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É
    $latitude = isset($_POST['latitude']) ? floatval($_POST['latitude']) : 0; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è —à–∏—Ä–æ—Ç–∏
    $longitude = isset($_POST['longitude']) ? floatval($_POST['longitude']) : 0; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–≤–≥–æ—Ç–∏
    $user_id = $_SESSION['user_id']; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è ID –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞

    // –°–µ—Ä–≤–µ—Ä–Ω–∞ –≤–∞–ª—ñ–¥–∞—Ü—ñ—è
    $ukrainianRegex = '/^[\x{0400}-\x{04FF}\s-]+$/u'; // –†–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –¥–ª—è —É–∫—Ä–∞—ó–Ω—Å—å–∫–∏—Ö –ª—ñ—Ç–µ—Ä
    if (!$type) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º–∏."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ —Ç–∏–ø –Ω–µ –≤–∏–±—Ä–∞–Ω–æ
    } elseif (!in_array($type, ['pothole', 'trash', 'light', 'sign', 'other'])) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –ù–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º–∏."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ —Ç–∏–ø –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π
    } elseif (!$description) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –í–≤–µ–¥—ñ—Ç—å –æ–ø–∏—Å –ø—Ä–æ–±–ª–µ–º–∏."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–ø–∏—Å –ø–æ—Ä–æ–∂–Ω—ñ–π
    } elseif (strlen($description) < 10) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –û–ø–∏—Å –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ —â–æ–Ω–∞–π–º–µ–Ω—à–µ 10 —Å–∏–º–≤–æ–ª—ñ–≤."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–ø–∏—Å –∑–∞–∫–æ—Ä–æ—Ç–∫–∏–π
    } elseif (strlen($description) > 500) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –û–ø–∏—Å –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 500 —Å–∏–º–≤–æ–ª—ñ–≤."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–ø–∏—Å –∑–∞–¥–æ–≤–≥–∏–π
    } elseif (!preg_match($ukrainianRegex, $description)) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –û–ø–∏—Å –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –ª–∏—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏, –ø—Ä–æ–±—ñ–ª–∏ —Ç–∞ –¥–µ—Ñ—ñ—Å–∏."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–ø–∏—Å –º—ñ—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —Å–∏–º–≤–æ–ª–∏
    } elseif (!$region) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –í–≤–µ–¥—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–±–ª–∞—Å—Ç—å –Ω–µ –≤–∏–±—Ä–∞–Ω–æ
    } elseif (!in_array($region, $allowed_regions)) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –û–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å –∑—ñ —Å–ø–∏—Å–∫—É –¥–æ–∑–≤–æ–ª–µ–Ω–∏—Ö."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –æ–±–ª–∞—Å—Ç—å –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∞
    } elseif (!$city) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –í–≤–µ–¥—ñ—Ç—å –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç –ø–æ—Ä–æ–∂–Ω—ñ–π
    } elseif (!preg_match($ukrainianRegex, $city)) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç –º–∞—î –º—ñ—Å—Ç–∏—Ç–∏ –ª–∏—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç –º—ñ—Å—Ç–∏—Ç—å –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω—ñ —Å–∏–º–≤–æ–ª–∏
    } elseif (strlen($city) > 100) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 100 —Å–∏–º–≤–æ–ª—ñ–≤."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç –∑–∞–¥–æ–≤–≥–∏–π
    } elseif ($latitude < 44 || $latitude > 53 || $longitude < 22 || $longitude > 40) {
        $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –º–∞—é—Ç—å –±—É—Ç–∏ –≤ –º–µ–∂–∞—Ö –£–∫—Ä–∞—ó–Ω–∏ (—à–∏—Ä–æ—Ç–∞: 44‚Äì53, –¥–æ–≤–≥–æ—Ç–∞: 22‚Äì40)."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –ø–æ–∑–∞ –º–µ–∂–∞–º–∏ –£–∫—Ä–∞—ó–Ω–∏
    } else {
        // –û–±—Ä–æ–±–∫–∞ —Ñ–æ—Ç–æ
        $photo_path = null;
        if (isset($_FILES['photo']) && $_FILES['photo']['error'] === UPLOAD_ERR_OK) {
            $allowed_types = ['image/jpeg', 'image/png', 'image/gif']; // –î–æ–∑–≤–æ–ª–µ–Ω—ñ —Ç–∏–ø–∏ —Ñ–∞–π–ª—ñ–≤
            $file_type = mime_content_type($_FILES['photo']['tmp_name']); // –¢–∏–ø —Ñ–∞–π–ª—É
            if (!in_array($file_type, $allowed_types)) {
                $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –î–æ–∑–≤–æ–ª–µ–Ω—ñ –ª–∏—à–µ —Ñ–∞–π–ª–∏ —Ñ–æ—Ä–º–∞—Ç—É JPEG, PNG –∞–±–æ GIF."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ —Ç–∏–ø —Ñ–∞–π–ª—É –Ω–µ–∫–æ—Ä–µ–∫—Ç–Ω–∏–π
            } elseif ($_FILES['photo']['size'] > 5 * 1024 * 1024) {
                $response['message'] = "–ü–æ–º–∏–ª–∫–∞: –§–∞–π–ª –Ω–µ –º–æ–∂–µ –ø–µ—Ä–µ–≤–∏—â—É–≤–∞—Ç–∏ 5 –ú–ë."; // –ü–æ–º–∏–ª–∫–∞, —è–∫—â–æ —Ñ–∞–π–ª –∑–∞–≤–µ–ª–∏–∫–∏–π
            } else {
                $photo_name = uniqid() . '-' . basename($_FILES['photo']['name']); // –£–Ω—ñ–∫–∞–ª—å–Ω–µ —ñ–º‚Äô—è —Ñ–∞–π–ª—É
                $photo_path = 'uploads/' . $photo_name; // –®–ª—è—Ö –¥–æ —Ñ–∞–π–ª—É
                if (!move_uploaded_file($_FILES['photo']['tmp_name'], '../' . $photo_path)) {
                    $response['message'] = "–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ."; // –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
                }
            }
        }

        // –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö
        if (!$response['message']) {
            $sql = "INSERT INTO reports (user_id, region, city, type, description, latitude, longitude, photo, status)
                    VALUES ($user_id, '$region', '$city', '$type', '$description', $latitude, $longitude, " . ($photo_path ? "'$photo_path'" : "NULL") . ", 'new')"; // –ó–∞–ø–∏—Ç –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–≤—ñ—Ç—É
            if ($conn->query($sql) === TRUE) {
                $response['success'] = true; // –£—Å–ø—ñ—à–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
                $response['message'] = "–ó–≤—ñ—Ç —É—Å–ø—ñ—à–Ω–æ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ! –ü–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ –π–æ–≥–æ —É <a href='profile.php'>–≤–∞—à–æ–º—É –ø—Ä–æ—Ñ—ñ–ª—ñ</a>.";
            } else {
                $response['message'] = "–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –∑–≤—ñ—Ç—É: " . $conn->error; // –ü–æ–º–∏–ª–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
                error_log("SQL Error: " . $conn->error);
            }
        }
    }
    if ($response['message']) {
        error_log("Form validation message: {$response['message']} (" . ($response['success'] ? 'success' : 'error') . ")"); // –ó–∞–ø–∏—Å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤ –ª–æ–≥
    }
    echo json_encode($response);
    exit;
}

// –Ø–∫—â–æ –Ω–µ POST, —Ä–µ–Ω–¥–µ—Ä–∏–º–æ —Ñ–æ—Ä–º—É
$version = time(); // –î–∏–Ω–∞–º—ñ—á–Ω–∏–π —Ç–∞–π–º—Å—Ç–µ–º–ø –¥–ª—è —É–Ω–∏–∫–Ω–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è
?>
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8"> <!-- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"> <!-- –í–∏–º–∫–Ω–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è -->
    <meta http-equiv="Pragma" content="no-cache"> <!-- –í–∏–º–∫–Ω–µ–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è –¥–ª—è —Å—Ç–∞—Ä–∏—Ö –±—Ä–∞—É–∑–µ—Ä—ñ–≤ -->
    <meta http-equiv="Expires" content="0"> <!-- –ù–µ–≥–∞–π–Ω–µ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è —Ç–µ—Ä–º—ñ–Ω—É –¥—ñ—ó -->
    <title>Vinc_Road - –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</title> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <link rel="stylesheet" href="../css/common.css?v=<?php echo $version; ?>"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ç–∏–ª—ñ–≤ -->
    <link rel="stylesheet" href="../css/report.css?v=<?php echo $version; ?>"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ –¥–ª—è –∑–≤—ñ—Ç—É -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" /> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ Leaflet -->
    <link rel="stylesheet" href="../css/responsive.css"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∞–¥–∞–ø—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∏–ª—ñ–≤ -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ Leaflet -->
</head>
<body>
    <button id="theme-toggle" class="theme-toggle">üåô</button> <!-- –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω–∏ —Ç–µ–º–∏ -->
    <header>
        <h1>Vinc_Road: –ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</h1> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
        <nav>
            <a href="index.php">–ì–æ–ª–æ–≤–Ω–∞</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É -->
            <a href="monitor.php">–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ -->
            <a href="analytics.php">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫—É -->
            <a href="report.php">–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É -->
            <a href="about.php">–ü—Ä–æ –Ω–∞—Å</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–æ –ø—Ä–æ—î–∫—Ç -->
            <a href="profile.php">–ü—Ä–æ—Ñ—ñ–ª—å</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ—Ñ—ñ–ª—å -->
            <a href="logout.php">–í–∏–π—Ç–∏</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤–∏—Ö–æ–¥—É -->
        </nav>
    </header>
    <main>
        <section class="intro">
            <h2>–ü–æ–≤—ñ–¥–æ–º—Ç–µ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</h2> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü—ñ—ó -->
            <p>–î–æ–ø–æ–º–æ–∂—ñ—Ç—å –∑—Ä–æ–±–∏—Ç–∏ –Ω–∞—à—ñ –º—ñ—Å—Ç–∞ –∫—Ä–∞—â–∏–º–∏! –ó–∞–ø–æ–≤–Ω—ñ—Ç—å —Ñ–æ—Ä–º—É –Ω–∏–∂—á–µ, —â–æ–± –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏. –í–∞—à –∑–≤—ñ—Ç –±—É–¥–µ —Ä–æ–∑–≥–ª—è–Ω—É—Ç–æ —è–∫–æ–º–æ–≥–∞ —à–≤–∏–¥—à–µ.</p> <!-- –û–ø–∏—Å -->
        </section>

        <section class="form-section">
            <form id="report-form" method="POST" enctype="multipart/form-data"> <!-- –§–æ—Ä–º–∞ –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É -->
                <div class="form-group">
                    <label for="type">–¢–∏–ø –ø—Ä–æ–±–ª–µ–º–∏ <span class="required">*</span></label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è —Ç–∏–ø—É -->
                    <select name="type" id="type"> <!-- –í–∏–ø–∞–¥–∞—é—á–∏–π —Å–ø–∏—Å–æ–∫ —Ç–∏–ø—ñ–≤ -->
                        <option value="">–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø</option>
                        <option value="pothole">–í–∏–±–æ—ó–Ω–∞</option>
                        <option value="trash">–°–º—ñ—Ç—Ç—è</option>
                        <option value="light">–û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è</option>
                        <option value="sign">–î–æ—Ä–æ–∂–Ω—ñ–π –∑–Ω–∞–∫</option>
                        <option value="other">–Ü–Ω—à–µ</option>
                    </select>
                    <small class="error-message" id="type-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <small class="form-hint">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é –ø—Ä–æ–±–ª–µ–º–∏, —è–∫—É –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–≤—ñ–¥–æ–º–∏—Ç–∏.</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <div class="form-group">
                    <label for="description">–û–ø–∏—Å <span class="required">*</span></label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –æ–ø–∏—Å—É -->
                    <textarea name="description" id="description" rows="4"></textarea> <!-- –ü–æ–ª–µ –¥–ª—è –æ–ø–∏—Å—É -->
                    <small class="error-message" id="description-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <small class="form-hint">–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É —è–∫–æ–º–æ–≥–∞ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ –ª–∏—à–µ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏.</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <div class="form-group">
                    <label for="region">–û–±–ª–∞—Å—Ç—å <span class="required">*</span></label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –æ–±–ª–∞—Å—Ç—ñ -->
                    <select name="region" id="region"> <!-- –í–∏–ø–∞–¥–∞—é—á–∏–π —Å–ø–∏—Å–æ–∫ –æ–±–ª–∞—Å—Ç–µ–π -->
                        <option value="">–û–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å</option>
                        <?php foreach ($allowed_regions as $reg): ?>
                            <option value="<?php echo htmlspecialchars($reg, ENT_QUOTES, 'UTF-8'); ?>"><?php echo htmlspecialchars($reg, ENT_QUOTES, 'UTF-8'); ?></option>
                        <?php endforeach; ?>
                    </select>
                    <small class="error-message" id="region-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <small class="form-hint">–í–∫–∞–∂—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å, –¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞.</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <div class="form-group">
                    <label for="city">–ù–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç <span class="required">*</span></label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É -->
                    <input type="text" name="city" id="city"> <!-- –ü–æ–ª–µ –¥–ª—è –Ω–∞—Å–µ–ª–µ–Ω–æ–≥–æ –ø—É–Ω–∫—Ç—É -->
                    <small class="error-message" id="city-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <small class="form-hint">–í–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ç–æ –∞–±–æ —Å–µ–ª–æ, –¥–µ —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞.</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <div class="form-group">
                    <label>–û–±–µ—Ä—ñ—Ç—å –º—ñ—Å—Ü–µ –Ω–∞ –∫–∞—Ä—Ç—ñ <span class="required">*</span></label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –∫–∞—Ä—Ç–∏ -->
                    <div id="map" style="height: 400px;"></div> <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–∏ -->
                    <small class="error-message" id="map-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <div id="location-loader" style="display: none; text-align: center; margin-top: 0.5rem;">
                        <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span> <!-- –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è -->
                    </div>
                    <input type="hidden" name="latitude" id="latitude"> <!-- –ü—Ä–∏—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ –¥–ª—è —à–∏—Ä–æ—Ç–∏ -->
                    <input type="hidden" name="longitude" id="longitude"> <!-- –ü—Ä–∏—Ö–æ–≤–∞–Ω–µ –ø–æ–ª–µ –¥–ª—è –¥–æ–≤–≥–æ—Ç–∏ -->
                    <small class="form-hint">–ö–ª—ñ–∫–Ω—ñ—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ñ, —â–æ–± –æ–±—Ä–∞—Ç–∏ —Ç–æ—á–Ω–µ –º—ñ—Å—Ü–µ –ø—Ä–æ–±–ª–µ–º–∏.</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <div class="form-group">
                    <label for="photo">–§–æ—Ç–æ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)</label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è —Ñ–æ—Ç–æ -->
                    <input type="file" name="photo" id="photo" accept="image/jpeg,image/png,image/gif"> <!-- –ü–æ–ª–µ –¥–ª—è —Ñ–æ—Ç–æ -->
                    <small class="error-message" id="photo-error"></small> <!-- –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                    <small class="form-hint">–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ, —â–æ–± –∫—Ä–∞—â–µ –ø—Ä–æ—ñ–ª—é—Å—Ç—Ä—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É (JPEG, PNG, GIF).</small> <!-- –ü—ñ–¥–∫–∞–∑–∫–∞ -->
                </div>

                <small class="error-message" id="form-error"></small> <!-- –ó–∞–≥–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
                <button type="submit" class="btn submit-btn">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–≤—ñ—Ç</button> <!-- –ö–Ω–æ–ø–∫–∞ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è -->
            </form>
        </section>

        <section class="instructions">
            <h3>–Ø–∫ –ø–æ–¥–∞—Ç–∏ –∑–≤—ñ—Ç?</h3> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π -->
            <ol>
                <li><strong>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø—Ä–æ–±–ª–µ–º–∏:</strong> –í–∫–∞–∂—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é, –¥–æ —è–∫–æ—ó –≤—ñ–¥–Ω–æ—Å–∏—Ç—å—Å—è –ø—Ä–æ–±–ª–µ–º–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏–±–æ—ó–Ω–∞, —Å–º—ñ—Ç—Ç—è).</li>
                <li><strong>–û–ø–∏—à—ñ—Ç—å –ø—Ä–æ–±–ª–µ–º—É:</strong> –î–µ—Ç–∞–ª—å–Ω–æ —Ä–æ–∑–∫–∞–∂—ñ—Ç—å, —â–æ —Å–∞–º–µ –≤–∞—Å —Ç—É—Ä–±—É—î, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ —É–∫—Ä–∞—ó–Ω—Å—å–∫—ñ –ª—ñ—Ç–µ—Ä–∏.</li>
                <li><strong>–í–∫–∞–∂—ñ—Ç—å –º—ñ—Å—Ü–µ:</strong> –û–±–µ—Ä—ñ—Ç—å –æ–±–ª–∞—Å—Ç—å —ñ –Ω–∞—Å–µ–ª–µ–Ω–∏–π –ø—É–Ω–∫—Ç, –∞ –ø–æ—Ç—ñ–º –≤–∫–∞–∂—ñ—Ç—å —Ç–æ—á–Ω–µ –º—ñ—Å—Ü–µ –Ω–∞ –∫–∞—Ä—Ç—ñ.</li>
                <li><strong>–î–æ–¥–∞–π—Ç–µ —Ñ–æ—Ç–æ (–∑–∞ –±–∞–∂–∞–Ω–Ω—è–º):</strong> –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–æ—Ç–æ, —â–æ–± –¥–æ–ø–æ–º–æ–≥—Ç–∏ —à–≤–∏–¥—à–µ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É–≤–∞—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É.</li>
                <li><strong>–ù–∞–¥—ñ—à–ª—ñ—Ç—å –∑–≤—ñ—Ç:</strong> –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ù–∞–¥—ñ—Å–ª–∞—Ç–∏ –∑–≤—ñ—Ç", —ñ –º–∏ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –≤–∞—à—É –∑–∞—è–≤–∫—É —è–∫–æ–º–æ–≥–∞ —à–≤–∏–¥—à–µ.</li>
            </ol>
        </section>
    </main>
    <footer>
        <p>¬© 2025 Vinc_Road - –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –£–∫—Ä–∞—ó–Ω–∏</p> <!-- –ù–∏–∂–Ω—ñ–π –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª -->
    </footer>
    <script src="../js/form.js?v=<?php echo $version; ?>"></script> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è —Ñ–æ—Ä–º–∏ -->
    <script src="../js/theme.js?v=<?php echo $version; ?>"></script> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–º—ñ–Ω–∏ —Ç–µ–º–∏ -->
</body>
</html>