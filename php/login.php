<?php
require_once '../includes/config.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å —Å–∏—Å—Ç–µ–º–∏
require_once '../includes/db.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
require_once '../includes/auth.php'; // –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ–π –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó

$conn = getDbConnection(); // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
$error = ''; // –ó–º—ñ–Ω–Ω–∞ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –ø—Ä–æ –ø–æ–º–∏–ª–∫–∏

if ($_SERVER['REQUEST_METHOD'] === 'POST') { // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —Ñ–æ—Ä–º–∞ –Ω–∞–¥—ñ—Å–ª–∞–Ω–∞
    $email = isset($_POST['email']) ? trim($_POST['email']) : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è email –∑ —Ñ–æ—Ä–º–∏
    $password = isset($_POST['password']) ? $_POST['password'] : ''; // –û—Ç—Ä–∏–º–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è –∑ —Ñ–æ—Ä–º–∏

    if (empty($email) || empty($password)) { // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∑–∞–ø–æ–≤–Ω–µ–Ω—ñ –≤—Å—ñ –ø–æ–ª—è
        $error = "–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å —É—Å—ñ –ø–æ–ª—è."; // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, —è–∫—â–æ –ø–æ–ª—è –ø–æ—Ä–æ–∂–Ω—ñ
    } else {
        if (login($email, $password, $conn)) { // –°–ø—Ä–æ–±–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
            if (isModerator()) { // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —î –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–æ–º
                header("Location: admin.php"); // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –º–æ–¥–µ—Ä–∞—Ç–æ—Ä–∞ –Ω–∞ –∞–¥–º—ñ–Ω-–ø–∞–Ω–µ–ª—å
            } else {
                header("Location: index.php"); // –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑–≤–∏—á–∞–π–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–∞ –≥–æ–ª–æ–≤–Ω—É
            }
            exit; // –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞
        } else {
            $error = "–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π email –∞–±–æ –ø–∞—Ä–æ–ª—å."; // –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
        }
    }
}

$conn->close(); // –ó–∞–∫—Ä–∏—Ç—Ç—è –∑‚Äô—î–¥–Ω–∞–Ω–Ω—è –∑ –±–∞–∑–æ—é –¥–∞–Ω–∏—Ö
?>

<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8"> <!-- –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∫–æ–¥—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ -->
    <title>–í—Ö—ñ–¥ - Vinc_Road</title> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
    <link rel="stylesheet" href="../css/common.css"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –æ—Å–Ω–æ–≤–Ω–∏—Ö —Å—Ç–∏–ª—ñ–≤ -->
    <link rel="stylesheet" href="../css/auth.css"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å—Ç–∏–ª—ñ–≤ –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó -->
    <link rel="stylesheet" href="../css/responsive.css"> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∞–¥–∞–ø—Ç–∏–≤–Ω–∏—Ö —Å—Ç–∏–ª—ñ–≤ -->
</head>
<body>
    <button id="theme-toggle" class="theme-toggle">üåô</button> <!-- –ö–Ω–æ–ø–∫–∞ –∑–º—ñ–Ω–∏ —Ç–µ–º–∏ -->
    <header>
        <h1>Vinc_Road: –í—Ö—ñ–¥</h1> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ -->
        <nav>
            <a href="index.php">–ì–æ–ª–æ–≤–Ω–∞</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –≥–æ–ª–æ–≤–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É -->
            <a href="monitor.php">–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É -->
            <a href="analytics.php">–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –∞–Ω–∞–ª—ñ—Ç–∏–∫—É -->
            <a href="report.php">–ü–æ–≤—ñ–¥–æ–º–∏—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º—É</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–≤—ñ—Ç—É -->
            <a href="about.php">–ü—Ä–æ –Ω–∞—Å</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –ø—Ä–æ –ø—Ä–æ—î–∫—Ç -->
            <?php if (isLoggedIn()): ?> <!-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á —É–≤—ñ–π—à–æ–≤ -->
                <a href="profile.php">–ü—Ä–æ—Ñ—ñ–ª—å</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ –ø—Ä–æ—Ñ—ñ–ª—å -->
                <a href="logout.php">–í–∏–π—Ç–∏</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –¥–ª—è –≤–∏—Ö–æ–¥—É -->
            <?php else: ?>
                <a href="login.php">–í—Ö—ñ–¥</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤—Ö–æ–¥—É -->
                <a href="register.php">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</a> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó -->
            <?php endif; ?>
        </nav>
    </header>
    <main>
        <section class="intro">
            <h2>–£–≤—ñ–π–¥—ñ—Ç—å –¥–æ –≤–∞—à–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É</h2> <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–µ–∫—Ü—ñ—ó -->
            <p>–í–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –ø–æ—á–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª—è—Ç–∏ –ø—Ä–æ –ø—Ä–æ–±–ª–µ–º–∏ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Ç–∞ –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –≤–∞—à—ñ –∑–≤—ñ—Ç–∏.</p> <!-- –û–ø–∏—Å -->
        </section>
        <section class="form-section">
            <?php if ($error): ?> <!-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —î –ø–æ–º–∏–ª–∫–∞ -->
                <p class="error"><?php echo htmlspecialchars($error); ?></p> <!-- –í–∏–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –ø–æ–º–∏–ª–∫—É -->
            <?php endif; ?>
            <form method="POST"> <!-- –§–æ—Ä–º–∞ –¥–ª—è –≤—Ö–æ–¥—É -->
                <div class="form-group">
                    <label for="email">Email</label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è email -->
                    <div class="input-wrapper">
                        <span class="icon">üìß</span> <!-- –Ü–∫–æ–Ω–∫–∞ –¥–ª—è –ø–æ–ª—è -->
                        <input type="email" name="email" id="email" required placeholder="–í–∞—à email"> <!-- –ü–æ–ª–µ –¥–ª—è email -->
                    </div>
                </div>

                <div class="form-group">
                    <label for="password">–ü–∞—Ä–æ–ª—å</label> <!-- –ú—ñ—Ç–∫–∞ –¥–ª—è –ø–æ–ª—è –ø–∞—Ä–æ–ª—è -->
                    <div class="input-wrapper">
                        <span class="icon">üîí</span> <!-- –Ü–∫–æ–Ω–∫–∞ –¥–ª—è –ø–æ–ª—è -->
                        <input type="password" name="password" id="password" required placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å"> <!-- –ü–æ–ª–µ –¥–ª—è –ø–∞—Ä–æ–ª—è -->
                    </div>
                </div>

                <button type="submit" class="btn">–£–≤—ñ–π—Ç–∏</button> <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ñ–æ—Ä–º–∏ -->
            </form>
            <p class="register-link">–ù–µ–º–∞—î –∞–∫–∞—É–Ω—Ç–∞? <a href="register.php">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—å</a>.</p> <!-- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—é -->
        </section>
    </main>
    <footer>
        <p>¬© 2025 Vinc_Road - –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥ —ñ–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –£–∫—Ä–∞—ó–Ω–∏</p> <!-- –ù–∏–∂–Ω—ñ–π –∫–æ–ª–æ–Ω—Ç–∏—Ç—É–ª -->
    </footer>
    <script src="../js/theme.js"></script> <!-- –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è —Å–∫—Ä–∏–ø—Ç–∞ –¥–ª—è –∑–º—ñ–Ω–∏ —Ç–µ–º–∏ -->
</body>
</html>